{% extends 'base.html' %}
{% block title %}
    Feed
{% endblock %}

{% block content %}
    <div class="text-center mb-5 pageHeading">
        <h1>Feed</h1>
        <h2>create, play, explore</h2>
    </div>

    <div class="container filter-bar">
        <div class="row justify-content-center">
                <select id="categoryFilter" onchange="filterGames()">
                    <option value="">All Categories</option>
                    <option value="history">History</option>
                    <option value="media">Media</option>
                    <option value="sports">Sports</option>
                    <option value="music">Music</option>
                    <option value="games">Games</option>
                    <option value="books">Books</option>
                    <option value="places">Places</option>
                    <option value="food">Food</option>
                </select>      
        </div>
    </div>


    <div class="container mt-5">
        <!-- Each row-->
        <div class="row mt-2 justify-content-start">
                {% set cols = 3 %}
                <!-- For each gamebox-->
                {% for game in games %}
                    <div class="col-4 mt-4" >
                        <button href="{{ url_for('hangman_page') }}" class="mb-5 card game-card {{ game.category|lower|replace('.', '')}}" data-category="{{ game.category|lower }}" data-time = "{{ game.timeLimit }}">
                            <div class="card-body">
                                <img class="profile-image" src="https://img.freepik.com/premium-vector/stick-figure-man-isolated-vector_566661-759.jpg"></img>
                                    <div class="category-name">
                                        {{ game.category }}
                                    </div>
                                    <div class="start-game">Start game!</div>
                                    <div class="user-info">
                                        @{{ game.creator.username }} - {{ game.caption }}
                                    </div>
                            </div>
                            <img class="hand right-hand" src="{{ url_for('static', filename='deliverables/gameFeed/hand-2.svg') }}"></img>
                            <img class="hand left-hand" src="{{ url_for('static', filename='deliverables/gameFeed/hand1.svg') }}"></img>
                        </button>
                    </div> 
                    
                    {% if loop.index % cols == 0 and not loop.last %}
                        <div class="row mt-2 justify-content-start"></div>
                    {% endif %}
                {% endfor %} 
        </div>
    </div>

    <div id="tooltip-htp"><b>How to play:</b><br>
        1. Filter by category and difficulty level to suit your gameplay.<br>
        2. Click on a game to play.<br>
        3. Complete the game within the time and moves limits to earn rewards!<br><br>
        <b>Create:</b><br>
        1. Follow the "create" button to make your own game.<br>
        2. Pick a category and set a word or phrase to be solved.<br>
        3. Choose a difficulty level to determine the number of guesses and time limit.<br>
        4. Add a caption and post to make your game live!
    </div>

    <div id="helpButton" class="text-center">
        <button id="help">?</button>
    </div>

    <div id="createButton">
        <a href="{{ url_for('create_page') }}"><button id="create">create</button><a>
    </div>

    
    <a href="#"><button id="chat">
        <div class="container text-center">
            <div class="row justify-content-between">
                <div id="chatHeading">
                    chat
                </div>
                <div class="col-4 pl-5" id="exitChat">
                    <span id="clickToExit">x</span>
                </div>
            </div>
        </div>
    </button><a>
    <div id="chatBody">
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            var toggleUp = false;

            $("#helpButton").mouseenter(function(){
                $('#tooltip-htp').css('display', 'block');
                $('#tooltop-htp').css('z-index', '5');
            });
            $("#helpButton").mouseleave(function(){
                $('#tooltip-htp').css('display', 'none');
                $('#tooltop-htp').css('z-index', '0');
            });
            $("#chat").on("click", function(){
                if(!toggleUp){
                    $('#chat').height($(window).height() / 1.5);
                    $('#chat').css('width', "40vw");
                    $('#chatBody').height($(window).height() / 1.5 - $('#chat').height())
                    $('#chatBody').css('width', "40vw");
                    $('#chatHeading').css('font-size', '180%');
                    $('#exitChat').css('font-size', '180%');
                    $('#chat').css('cursor', 'default');
                    $('#chatHeading').addClass('col-4 pr-5');
                    toggleUp = true;
                }
            });
            $("#clickToExit").on("click", function(){
                event.stopPropagation();
                $('#chat').height('');
                $('#chat').css('width', '');
                $('#chatBody').height('');
                $('#chatBody').css('width', '');
                $('#chatHeading').css('font-size', '');
                $('#chat').css('cursor', 'pointer');
                $('#chatHeading').removeClass('col-4 pr-5')
                $('#exitChat').css('font-size', '');
                toggleUp = false;
            });
            $('.game-card').mouseenter(function(){
                    $(this).find('.category-name').hide();
                    $(this).find('.start-game').css('visibility', 'visible');
                    $(this).find('.hand').show();
            });
            $('.game-card').mouseleave(function(){
                    $(this).find('.category-name').show();
                    $(this).find('.start-game').css('visibility', 'hidden');
                    $(this).find('.hand').hide();
            });
        }); 
        function filterGames() {
            const categoryFilter = document.getElementById('categoryFilter').value.toLowerCase();
            const gameCards = document.querySelectorAll('.game-card');

            gameCards.forEach(card => {
                const gameCategory = card.getAttribute('data-category').toLowerCase();
                const cardParent = card.parentNode;

                if ((categoryFilter === '' || gameCategory === categoryFilter)) {
                    cardParent.style.display = '';
                } else {
                    cardParent.style.display = 'none';
                }
            });
        }


        
            
    </script>

    <style>
        *{
            font-family: "Indie Flower", sans-serif;
        }

        .filter-bar{
            padding: 1vh;
        }
        #categoryFilter {
            border: 2px solid #0a0a08;
            background-color: #ffef5b;
            font-size: 1vw;
            font-weight: 900;
            border-radius: 10px;
            height: 5vh;
            padding: 2px;
            width: 10vw;
            margin-right: 10vw;
        }

        #categoryFilter option {
            background-color: #efefa9;
            border-radius: 2px solid;
            color: #140e0e;
        }

        .pageHeading h1{
            font-size: 3vw;
            font-family: "Indie Flower", sans-serif;
            font-weight: 500;
            color: #ebd834;
            margin-top: 120px;
        }

        .pageHeading h2{
            color:black;
            font-family: "Indie Flower", sans-serif;
            font-weight: bold;
            font-size:2vw;
        }

        .container {
            @include make-container();
            padding-left: 10vw;
            width: 75%;
        }

        
        #helpButton{
            position:fixed;
            bottom:10%;
            left:10%;
            z-index:2;
        }

        #help{
            @media screen and (max-width: 600px) {
                height:4.5vw;
                width:4.5vw;
                font-size:3vw;
            }
            @media screen and (min-width: 601px) {
                height:2.5vw;
                width:2.5vw;
                font-size:1.6vw;
            }
            border-radius:50%;
            background-color:#ebd834;
            color:black;
            font-family: "Indie Flower", sans-serif;
            font-weight:bold;
            pointer-events:none;
        }

        #tooltip-htp{
            padding:1%;
            background-color: #fcf4ac;
            position:fixed;
            color:black;
            left:10%;
            z-index: 1000;
            text-align:left;
            @media screen and (max-width: 600px) {
                height:40vw;
                width:30vw;
                font-size:1.5vw;
                bottom:15%;
            }
            @media screen and (min-width: 601px) {
                height:25vw;
                width:15vw;
                font-size:0.8vw;
                bottom:17%;
            }
            display:none;
            transition:0.3s ease;
        }

        #createButton{
            position:fixed;
            bottom:10%;
            left:50%;
            transform: translate(-50%, 0);
            z-index:4;
        }

        #create{
            border-radius:50px;
            @media screen and (max-width: 600px) {
                height:5vw;
                width:14vw;
                font-size:3vw;
            }
            @media screen and (min-width: 601px) {
                height:2.5vw;
                width:8vw;
                font-size:1.5vw;
            }
            font-family: "Indie Flower", sans-serif;
            font-weight:bold;
            background-color: #ebd834;
            box-shadow: white 0 0 100px 50px;
        }

        #chat{
            @media screen and (max-width: 600px) {
                height:5vw;
                width:14vw;
                font-size:3vw;
            }
            @media screen and (min-width: 601px) {
                height:2.5vw;
                width:16vw;
                font-size:1.5vw;
            }
            background-color: #ebd834;
            border-bottom:none;
            border-top-left-radius:10px;
            border-top-right-radius:10px;
            transition:0.5s ease;
            position:fixed;
            bottom:0%;
            right: 10%;
            display: inline-flex;
            justify-content:center;
            z-index: 10;
        }

        #chatHeading{
            transition: 0.5s ease;
            font-family: "Indie Flower", sans-serif;
            font-weight:bold;
        }

        #exitChat{
            font-size: 0;
            font-family: "Indie Flower", sans-serif;
            font-weight:bold;
        }

        #clickToExit{
            cursor: pointer;
            z-index: 3;
        }

        #chatBody{
            @media screen and (max-width: 600px) {
                height:5vw;
                width:14vw;
                font-size:3vw;
            }
            @media screen and (min-width: 601px) {
                height:2.5vw;
                width:16vw;
                font-size:1.5vw;
            }
            background-color:white;
            border-bottom:none;
            transition:0.5s ease;
            position:fixed;
            bottom:-6%;
            right: 10%;
            border: solid 2px black;
        }

        .game-card {
            width: 10vw; 
            height: 10vw;
            border: none;
            text-align: left;
            cursor: pointer;
            border-radius: 70px 70px 0px 0px;
            transition: transform 0.3s ease; 
            z-index:4;
            border: 2px solid black;
        }
        .game-card::before, .game-card::after {
            content: '';
            position: absolute;
            top: 100%; 
            width: 5px; 
            height: 0vh; 
            background-color: black;
            transition: height 0.3s ease; 
        }

        .game-card::before {
            left: 25%; 
        }
        .game-card::after {
            right: 25%; 
        }
        .game-card:hover {
            transform: translateY(-10px); 
        }
        .game-card:hover::before, .game-card:hover::after {
            height: 8vh; 
        }
        @media (max-width: 768px) {
            .game-card::before, .game-card::after {
                height: 0vh; 
            }

            .game-card:hover::before, .game-card:hover::after {
                height: 2vh; 
            }
        }

        .game-card .card-body {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100%;
          width: 100%;
        }
      
        .game-card .profile-image {
          width: 4vw;
          height: 4vw;
          border-radius: 50%;
          object-fit: cover;
          border: 2px solid black;
          z-index: 3;
          position: absolute; 
          top: -20%; 
          left: 50%;
          transform: translateX(-50%); 
        }
      
        .game-card .category-name {
          font-size: 1.5vw;
          position:absolute;
          font-weight: bold;
          text-align:center;
          padding-bottom: 2vh;
        }
      
        .game-card .user-info {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 35%;
          background-color: rgba(205, 203, 203, 0.4);
          padding-left: 10%;
          padding-right: 5%;
          display: flex;
          justify-content: start;
          align-items: center;
          word-wrap: break-word;
          box-sizing: border-box; 
          font-size: 0.7vw;
        }
      
        .start-game {
            visibility: hidden;
            position:absolute;
            font-size: 1.2vw;
            font-weight: bolder;
            background-color: transparent;
            color: black;
            padding-bottom: 2vh;
          }

        .history{
            background-color:#FFD33B;
        }

        .media{
            background-color:#FF7AB2;
        }

        .sports{
            background-color:#7AE864;
        }
        
        .music{
            background-color:#FD9A5C;
        }

        .games{
            background-color:#CE64E8;
        }

        .books{
            background-color:#5C6FC8;
        }

        .places{
            background-color:#9ACBFF;
        }

        .food{
            background-color:#FF4040;
        }

        .misc{
            background-color:#C1FF72;
        }

        .game-card:hover{
          box-shadow: 1px 1px 20px rgb(215, 215, 213);
        }

        .hand{
            display: none;
            position: absolute;
            transition: all 0.3s ease;
            width: 5vw; 
            height: auto; 
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .left-hand {
            left: calc(50% - 4.5vw); 
            top: 70%;
            transform: translateY(-50%) translateX(-100%);
        }
        .right-hand {
            right: calc(50% - 14vw); 
            top: 40%;
            transform: translateY(-50%) translateX(-100%);
        }
        .game-card:hover .hand {
            display: block; 
        }

    </style>
{% endblock %}